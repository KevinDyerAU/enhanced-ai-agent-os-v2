# Monitoring Setup for Training Validation Service

This document outlines the monitoring configuration for the Training Validation Service, including Prometheus metrics and Grafana dashboards.

## Overview

The monitoring setup consists of:

1. **Prometheus** - For metrics collection and storage
2. **Grafana** - For visualization and dashboards
3. **Custom Metrics** - Application-specific metrics exposed by the service

## Prerequisites

- Docker and Docker Compose
- Access to the project's `docker-compose` files
- Ports 9090 (Prometheus) and 3001 (Grafana) available

## Configuration Details

### 1. Prometheus Configuration

The Prometheus server is configured via `deployment/prometheus.yml` with the following scrape targets:

- `training-validation-service`: Metrics from the Training Validation Service (port 8033)
- `orchestration-agent`: Orchestration service metrics
- `postgres`: Database metrics

### 2. Grafana Configuration

Grafana is pre-configured with:

- **Username**: `admin`
- **Password**: `admin`
- **Data Source**: Prometheus (auto-configured to `http://prometheus:9090`)

### 3. Service Metrics

The Training Validation Service exposes the following metrics:

#### HTTP Request Metrics (Automatic)

- `http_request_duration_seconds` - Request duration histogram
- `http_requests_total` - Total request count
- `http_request_size_bytes` - Request size distribution
- `http_response_size_bytes` - Response size distribution

#### Custom Metrics

- `training_validation_requests_total` - Total validation requests by endpoint and status
- `training_validation_duration_seconds` - Duration of validation requests
- `training_validation_sessions_total` - Number of validation sessions by status
- `training_validation_documents_processed_total` - Documents processed by status

## Accessing the Dashboards

1. **Prometheus**: http://localhost:9090
   - Check status of targets under Status > Targets
   - Query metrics under Graph

2. **Grafana**: http://localhost:3001
   - Default credentials: admin/admin
   - Pre-configured dashboards should be available

## Adding Custom Dashboards

To add a new dashboard in Grafana:

1. Log in to Grafana
2. Navigate to Dashboards > New Dashboard
3. Add panels for the desired metrics
4. Save the dashboard with a descriptive name

## Troubleshooting

### Metrics Not Showing Up

1. Verify the service is running: `docker-compose ps`
2. Check Prometheus targets: http://localhost:9090/targets
3. Verify metrics endpoint: `curl http://localhost:8033/metrics`

### Common Issues

- **Connection refused**: Ensure the service is running and exposing the correct port
- **No data**: Check if metrics are being generated by the application
- **Permission issues**: Verify file permissions for Prometheus data directory

## Maintenance

### Updating Metrics

To add new metrics:

1. Add the metric definition in `monitoring/metrics.py`
2. Update the relevant service code to use the new metric
3. Update this documentation if necessary

### Backup and Restore

- **Prometheus data**: Back up the `prometheus_data` volume
- **Grafana data**: Back up the `grafana_data` volume
- **Dashboards**: Export dashboards from Grafana UI as JSON
